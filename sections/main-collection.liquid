{{ 'section-main-collection.css' | asset_url | stylesheet_tag }}
{{ 'component-facets.css' | asset_url | stylesheet_tag }}

<div id="CollectionProductGrid" class="collection page-width">
  <div class="collection__filters" id="CollectionFilters">
    {%- if section.settings.enable_filtering -%}
      <div class="collection-filters">
        <div class="collection-filters__header">
          <h2 class="collection-filters__title">Filters</h2>
          <button type="button" class="collection-filters__close" aria-label="Close filters">
            {% render 'icon-close' %}
          </button>
        </div>
        
        <div class="collection-filters__content">
          {%- for filter in collection.filters -%}
            <details class="collection-filters__filter" open>
              <summary class="collection-filters__filter-title">
                {{ filter.label }}
                {%- if filter.active_values.size > 0 -%}
                  <span class="collection-filters__active-count">({{ filter.active_values.size }})</span>
                {%- endif -%}
              </summary>
              
              <div class="collection-filters__filter-content">
                {%- case filter.type -%}
                  {%- when 'list' -%}
                    <ul class="collection-filters__list">
                      {%- for filter_value in filter.values -%}
                        <li class="collection-filters__item">
                          <label class="collection-filters__checkbox">
                            <input
                              type="checkbox"
                              name="{{ filter_value.param_name }}"
                              value="{{ filter_value.value }}"
                              {% if filter_value.active %}checked{% endif %}
                              {% if filter_value.count == 0 and filter_value.active == false %}disabled{% endif %}
                            >
                            <span class="collection-filters__label">
                              {{ filter_value.label }}
                              <span class="collection-filters__count">({{ filter_value.count }})</span>
                            </span>
                          </label>
                        </li>
                      {%- endfor -%}
                    </ul>
                  {%- when 'price_range' -%}
                    <div class="collection-filters__price-range">
                      <div class="collection-filters__price-inputs">
                        <label class="collection-filters__price-label">
                          <span>From</span>
                          <input
                            type="number"
                            name="{{ filter.min_value.param_name }}"
                            value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
                            placeholder="0"
                            min="0"
                            max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                          >
                        </label>
                        <label class="collection-filters__price-label">
                          <span>To</span>
                          <input
                            type="number"
                            name="{{ filter.max_value.param_name }}"
                            value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                            placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                            min="0"
                            max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                          >
                        </label>
                      </div>
                      <div class="collection-filters__price-range-slider" data-price-range>
                        <input type="range" min="0" max="{{ filter.range_max | money_without_currency | replace: ',', '' }}" value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}">
                        <input type="range" min="0" max="{{ filter.range_max | money_without_currency | replace: ',', '' }}" value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}">
                      </div>
                    </div>
                {%- endcase -%}
              </div>
            </details>
          {%- endfor -%}
        </div>
        
        <div class="collection-filters__footer">
          <a href="{{ collection.url }}" class="collection-filters__clear">Clear all</a>
          <button type="button" class="button collection-filters__apply">Apply filters</button>
        </div>
      </div>
    {%- endif -%}
  </div>

  <div class="collection__products">
    <div class="collection__header">
      <h1 class="collection__title">{{ collection.title }}</h1>
      {%- if collection.description != blank -%}
        <div class="collection__description rte">{{ collection.description }}</div>
      {%- endif -%}
      
      <div class="collection__toolbar">
        {%- if section.settings.enable_filtering -%}
          <button type="button" class="collection__filter-toggle" aria-label="Open filters">
            <span>Filters</span>
            {% render 'icon-filter' %}
            {%- assign active_filters_count = collection.filters | where: 'active_values', true | size -%}
            {%- if active_filters_count > 0 -%}
              <span class="collection__filter-count">{{ active_filters_count }}</span>
            {%- endif -%}
          </button>
        {%- endif -%}
        
        {%- if section.settings.enable_sorting -%}
          <div class="collection__sort">
            <label for="SortBy" class="collection__sort-label">Sort by:</label>
            <select name="sort_by" id="SortBy" class="collection__sort-select">
              {%- for option in collection.sort_options -%}
                <option value="{{ option.value }}" {% if option.value == collection.sort_by %}selected{% endif %}>
                  {{ option.name }}
                </option>
              {%- endfor -%}
            </select>
          </div>
        {%- endif -%}
      </div>
    </div>

    <div class="collection__grid grid grid--{{ section.settings.columns_desktop }}-col-desktop grid--2-col-tablet-down">
      {%- for product in collection.products -%}
        <div class="grid__item">
          {% render 'product-card', product: product, show_quick_add: true, show_sustainability: true %}
        </div>
      {%- else -%}
        <div class="collection__empty">
          <p>No products found in this collection.</p>
        </div>
      {%- endfor -%}
    </div>

    {%- paginate collection.products by section.settings.products_per_page -%}
      {%- if paginate.pages > 1 -%}
        {% render 'pagination', paginate: paginate %}
      {%- endif -%}
    {%- endpaginate -%}
  </div>
</div>

<script src="{{ 'collection-filters.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "Collection",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 24,
      "step": 1,
      "default": 16,
      "label": "Products per page"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Number of columns on desktop"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt to image"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        },
        {
          "value": "square",
          "label": "Square"
        }
      ],
      "default": "adapt",
      "label": "Image ratio"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": true,
      "label": "Show second image on hover"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show product vendor"
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "default": true,
      "label": "Enable filtering"
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "default": true,
      "label": "Enable sorting"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_filters",
      "default": true,
      "label": "Enable sticky filters on scroll"
    },
    {
      "type": "select",
      "id": "filter_type",
      "options": [
        {
          "value": "drawer",
          "label": "Drawer"
        },
        {
          "value": "sidebar",
          "label": "Sidebar"
        }
      ],
      "default": "drawer",
      "label": "Filter layout"
    }
  ]
}
{% endschema %}

